# 交易费用

## 概述

用户在使用Neo网络时，需要支付一定的费用。系统具有两种不同的费用类型，即系统费和网络费。所有费用均通过系统功能代币GAS（NeoGas）进行支付。

| 类型| 说明|
|-------------|---------------------------------------------------------------------|
| 网络费|支付给验证人打包交易的费用|
| 系统费| 支付交易执行消耗的资源费用 |

### 网络费

对于大小不超过1024字节的交易，网络费用目前是可选的。增加网络费用（最低为0.001GAS）将使交易具有更高的优先级。目前在NEO网络中每个区块只能包含20个低优先级的交易，因此在网络流量大的时候支付更高的网络费用可以使得交易更快得到处理。

对于大小超过1024字节的交易需要支付0.001GAS的基础费用，超过1024字节的部分按每字节0.00001GAS收取网络费用。大多数基本的NEP-5资产转账交易大小仍然是远低于1024字节阈值的，但是逻辑更复杂或者有大量输入和输出的交易可能会超过这一阈值并需要支付网络费用。每个交易的网络费存在一个最小值，计算公式如下所示：

 $$ NetworkFee = VerificationCost + tx.Length * FeePerByte $$

其中，VerificationCost为虚拟机验证交易签名消耗的费用，tx.Length为交易数据的字节长度，FeePerByte为交易每字节的费用。用户支付的网络费需要大于或等于此最小值，否则交易无法通过验证。

内存池中交易的优先级取决于每字节支付的费用。网络费用可以由验证人收集并分发到任意合约地址。

### 系统费

系统费用是根据NeoVM要执行的指令计算得出的固定费用。一般来说，交易对网络资源的需求越大，交易的成本就越高。交易成功上链后，系统费将成为NEO持有者权益分红，持有者可以通过提取GAS的操作获得分红。

$$SystemFee=\sum_{i\in OpcodeSet}OpcodePrice_{i}*n_{i}$$

其中，OpcodeSet为指令集，为第i种指令的费用，为第i种指令在合约脚本中的个数。

#### 系统调用

| 系统调用               | 费用(GAS)                                                                       |
|-----------------------------|---------------------------------------------------------------------------------|
| *默认的*                   |所有系统调用花费`0.001`  |
| `Runtime.CheckWitness`      | `0.2`                                                                           |
| `Blockchain.GetHeader`      | `0.1`                                                                           |
| `Blockchain.GetBlock`       | `0.2`                                                                           |
| `Blockchain.GetTransaction` | `0.1`                                                                           |
| `Blockchain.GetAccount`     | `0.1`                                                                           |
| `Blockchain.GetValidators`  | `0.2`                                                                           |
| `Blockchain.GetAsset`       | `0.1`                                                                           |
| `Blockchain.GetContract`    | `0.1`                                                                           |
| `Transaction.GetReferences` | `0.2`                                                                           |
| `Account.SetVotes`          | `1`                                                                             |
| `Validator.Register`        | `1000`                                                                          |
| `Contract.Create`           | 每个合约花费`100`, 使用存储花费`400`, 使用动态调用花费`500` |
| `Contract.Migrate`          | 每个合约花费`100`, 使用存储花费`400`, 使用动态调用花费`500` |
| `Storage.Get`               | `0.1`                                                                           |
| `Storage.Put`               |每千字节花费`1`                                                                  |
| `Storage.Delete`            | `0.1`                                                                           |

#### 指令

| 指令| 费用(GAS)                                           |
|---------------------------|-----------------------------------------------------|
| *默认的*                 | 虚拟机中所有的指令都花费`0.001` |
| `OpCode.PUSH16` (or less) | `0`                                                 |
| `OpCode.NOP`              | `0`                                                 |
| `OpCode.APPCALL`          | `0.01`                                              |
| `OpCode.TAILCALL`         | `0.01`                                              |
| `OpCode.SHA1`             | `0.01`                                              |
| `OpCode.SHA256`           | `0.01`                                              |
| `OpCode.HASH160`          | `0.02`                                              |
| `OpCode.HASH256`          | `0.02`                                              |
| `OpCode.CHECKSIG`         | `0.1`                                               |
| `OpCode.CHECKMULTISIG`    | 每个签名花费`0.1`                               |

## 应用中的使用费用
Neo网络中部署的任何应用都可以要求用户支付一定的费用，以便使用智能合约功能。通常是以NEP-5兼容的功能代币作为支付手段，不过也可以直接收取GAS。

